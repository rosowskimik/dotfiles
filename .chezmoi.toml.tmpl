{{- $isHeadless := promptBoolOnce . "isHeadless" "Is headless machine" -}}
{{- $isContainer := promptBoolOnce . "isContainer" "Inside a container" -}}
{{- $isNvidia := promptBoolOnce . "isNvidia" "Uses Nvidia" -}}
{{- $battery := promptStringOnce . "battery" "Battery entry" -}}
{{- $email := promptStringOnce . "email" "Email address" -}}

{{- $chassisType := "desktop" }}
{{- if eq .chezmoi.os "darwin" }}
{{-   if contains "MacBook" (output "sysctl" "-n" "hw.model") }}
{{-     $chassisType = "laptop" }}
{{-   else }}
{{-     $chassisType = "desktop" }}
{{-   end }}
{{- else if eq .chezmoi.os "linux" }}
{{-   $chassisType = (output "hostnamectl" "--json=short" | mustFromJson).Chassis }}
{{- else if eq .chezmoi.os "windows" }}
{{-   $chassisType = (output "powershell.exe" "-NoProfile" "-NonInteractive" "-Command" "if ((Get-CimInstance -Class Win32_Battery | Measure-Object).Count -gt 0) { Write-Output 'laptop' } else { Write-Output 'desktop' }") | trim }}
{{- end }}

[diff]
	command = "delta"
	args = ["-n", "-s", "--pager", "never", "{{ "{{" }} .Destination {{ "}}" }}", "{{ "{{" }} .Target {{ "}}" }}"]
	{{- if eq .chezmoi.osRelease.id "debian" }}
	pager = "batcat"
	{{- else }}
	pager = "bat"
	{{- end }}

[data]
	isHeadless = {{ $isHeadless }}
	isContainer = {{ $isContainer }}
	isDesktop = {{ eq $chassisType "desktop" }}
	isNvidia = {{ $isNvidia }}

	email = {{ $email | quote }}
	nproc = {{ output "nproc" }}
	battery = {{ $battery | quote }}

	{{ if eq .chezmoi.osRelease.id "debian" -}}
	icon = ""
	{{- else if eq .chezmoi.osRelease.id "arch" }}
	icon = ""
	{{- else }}
	icon = ""
	{{- end }}

	{{- if eq .chezmoi.hostname "ThinkBookArch" }}
	wall = "/home/mroso/Pictures/Wallpapers/wallhaven-rddgwm.jpg"
	lock = "/home/mroso/Pictures/Wallpapers/wallhaven-3lyrvy.png"
	{{- end }}
