{{- $isHeadless := promptBoolOnce . "isHeadless" "Is headless machine" -}}
{{- $isContainer := promptBoolOnce . "isContainer" "Inside a container" -}}
{{- $isNvidia := promptBoolOnce . "isNvidia" "Uses Nvidia" -}}
{{- $email := promptStringOnce . "email" "Email address" -}}

{{- $chassisType := "desktop" }}
{{- $battery := "" }}


{{- if (eq .chezmoi.os "darwin") }}
{{-   if contains "MacBook" (output "sysctl" "-n" "hw.model") }}
{{-     $chassisType = "laptop" }}
{{-   else }}
{{-     $chassisType = "desktop" }}
{{-   end }}
{{- else if and (eq .chezmoi.os "linux") (lookPath "hostnamectl") }}
{{-   $chassisType = (output "hostnamectl" "--json=short" | mustFromJson).Chassis }}
{{- else if (eq .chezmoi.os "windows") }}
{{-   $chassisType = (output "powershell.exe" "-noprofile" "-command" "if (Get-WmiObject -Class win32_battery -ComputerName localhost) { echo laptop } else { echo desktop }") }}
{{- end -}}

{{- if eq $chassisType "laptop" }}
{{- $battery = promptStringOnce . "battery" "Battery Path" }}
{{- end }}

[diff]
	command = "delta"
	args = ["-n", "-s", "--pager", "never", "{{ "{{" }} .Destination {{ "}}" }}", "{{ "{{" }} .Target {{ "}}" }}"]
	{{- if eq .chezmoi.osRelease.id "debian" }}
	pager = "batcat"
	{{- else }}
	pager = "bat"
	{{- end }}

[data]
	isHeadless = {{ $isHeadless }}
	isContainer = {{ $isContainer }}
	isDesktop = {{ eq $chassisType "desktop" }}
	isNvidia = {{ $isNvidia }}


	email = {{ $email | quote }}
	nproc = {{ output "nproc" }}
	chassisType = {{ $chassisType | quote }}

	{{ if eq .chezmoi.osRelease.id "debian" -}}
	icon = ""
	{{- else if eq .chezmoi.osRelease.id "arch" }}
	icon = ""
	{{- else }}
	icon = ""
	{{- end }}

	battery = {{ $battery | quote }}

	{{- if eq .chezmoi.hostname "ThinkBookArch" }}
	wall = "/home/{{- .chezmoi.username -}}/Pictures/Wallpapers/wallhaven-rddgwm.jpg"
	lock = "/home/{{- .chezmoi.username -}}/Pictures/Wallpapers/wallhaven-3lyrvy.png"
	{{- end }}
	{{- if eq .chezmoi.hostname "ant" }}
	wall = "/home/{{- .chezmoi.username -}}/Pictures/Wall/wallhaven-6dgz2l.jpg"
	lock = "/home/{{- .chezmoi.username -}}/Pictures/Wall/wallhaven-3lyrvy.png"
	{{- end }}
